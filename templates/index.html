<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>人事データ抽出</title>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // 初期フォーカス設定
            const inputField = document.querySelector('input[name="nenrei"]');
            inputField.focus();

            // Enterキーで送信処理
            inputField.addEventListener("keydown", function(event) {
                if (event.key === "Enter") {
                    event.preventDefault(); // デフォルト動作を防ぐ
                    fetchData(); // データ取得処理を呼び出し
                }
            });
        });
    </script>
</head>

<style>
    h1 {
        text-align: center;
        font-weight:bold;
        background-color: #f3f3f3;
        color: #2E8B57;
        padding: 10px;
        border-radius: 5px;
        font-family: 'Arial', sans-serif;
        font-size: 2em;
    }

    .block > * {
        margin-bottom: 20px; /* 各要素の下に20pxの余白を追加 */
    }
    .highlight {
        color: #ffffff; /* 文字の色を白に */
        background-color: #ff4500; /* 背景色をオレンジ系に */
        padding: 5px 10px; /* 余白を追加して目立たせる */
        border-radius: 5px; /* 角を丸くして柔らかい印象に */
        font-size: 20px; /* フォントサイズを調整 */
        font-weight: bold; /* 文字を太字に */
    }
    .highlight-input {
        font-size: 20px; /* フォントサイズを大きくして視認性をアップ */
        padding: 10px; /* フィールドに余白を追加 */
        border: 2px solid #ff4500; /* 太めの枠線をオレンジ色で */
        border-radius: 5px; /* 角を少し丸めて柔らかい印象に */
        background-color: #fce4ec; /* 背景を淡いピンクに設定 */
        color: #000; /* テキストの色を黒に */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* 少し影をつけて浮き上がらせる効果を追加 */
    }
    button {
        padding: 10px 20px; /* サイズ調整 */
        font-size: 16px;   /* テキストの大きさ */
        border-radius: 5px; /* 丸みを追加 */
        background: linear-gradient(45deg, #6a5acd, #00bfff);
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    button:hover {
        background: linear-gradient(45deg, #00bfff, #6a5acd);
    }
    #result-area {
        color: #006400; /* 深緑色 */
        background-color: #f3f3f3; /* 淡い背景色でコントラストを追加 */
        padding: 10px; /* 余白を追加 */
        border: 1px solid #006400; /* 境界線も深緑で統一 */
        border-radius: 5px; /* 角を少し丸くする */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* 少し影をつけて浮き上がらせる */
        font-size: 18px; /* フォントサイズを大きくして目立たせる */
    }
    .person {
        position: relative;
        display: inline-block;
        cursor: pointer;
        margin: 5px;
    }

    .person:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        top: 100%;
        left: 50%;
        transform: translateX(-50%);
        background-color: #fff;
        color: #333;
        padding: 5px 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        white-space: nowrap;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 10;
    }
</style>
<body>
    <h1>対象部署 人事データ</h1>
    <form action="/抽出" method="POST" id="data-form">
        <label class="highlight" for="department">部署名を選択して下さい:</label>
        <select id="department" name="department" class="highlight-input"
            required style="width: 200px; height: 45px;">
        </select>
        <button id="submit-btn" type="button">送信</button>
    </form>
    <div id="department-result-area">ここに結果が表示されます。</div>
    <div id="department-container"></div>

</body>
<form>
    <script>
        // 食魚リストを取得してドロップダウンに追加
        fetch('/get_departments')
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById('department');
                data.departments.forEach(department => {
                    const option = document.createElement('option');
                    option.value = department;
                    option.textContent = department;
                    select.appendChild(option);
                });
            })
            .catch(error => {
                console.error('部署リストの取得に失敗しました:', error);
            });

        document.getElementById("submit-btn").addEventListener("click", function() {
            // フォームデータを収集
            const formData = new FormData(document.getElementById("data-form"));
            fetch("/抽出", { method: "POST", body: formData })
                .then(response => response.json())
                .then(data => {
                    if (data.response) {
                        // 結果を整形して表示
                        document.getElementById("department-result-area").innerHTML =
                        data.response.replace(/\n/g, "<br>");
                    } else if (data.message) {
                        document.getElementById("department-result-area").innerHTML = data.message;
                    }
                })
                .catch(error => console.error("エラー:", error));
            });
    </script>
</form>

<body>
    <h1>対象年齢　人事データ</h1>
    <form method="POST" action="/filter">
        <label class="highlight">対象年齢（以上抽出）を入力して下さい: </label>
        <input type="number" id="nenrei" name="nenrei" required class="highlight-input" />
        <!-- HTML部分 -->
        <br>
        <br>
        <button id="extract-btn">抽出（一覧表示）</button>
        <div id="result-area"></div>
        <div id="container">
        <!-- Pythonが生成したツールチップHTMLがここに挿入されます -->
        </div>
</body>
</form>
    <script>
        document.getElementById("extract-btn").addEventListener("click", function() {
            fetchData(); // データ取得処理を呼び出し
        });

    function fetchData() {
        const nenrei = document.getElementById("nenrei").value; // 入力値を取得
        const resultArea = document.getElementById("result-area");

        if (!nenrei || isNaN(nenrei) || nenrei <= 0) {
            resultArea.style.color = "red"; // 赤色
            resultArea.textContent = "年齢を選んで下さい。";
            return
        }

        fetch("/filter", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `nenrei=${nenrei}`
        })
        .then(response => response.text()) // レスポンスをテキストに変換
        .then(data => {
            // レスポンスデータが空でないか確認
            if (!data) {
                resultArea.style.color = "red"; // 赤色
                resultArea.textContent = "該当データがありません。";
                return;
            }
            // レスポンスデータを改行で分割して表示
            resultArea.style.color = "#006400"; // 深緑色
            resultArea.innerHTML = ""; // 結果を初期化
            const lines = data.split("\n").filter(line => line.trim() !== ""); // 空行を除外
            if (lines.length === 0) {
                resultArea.style.color = "red"; // 赤色
                resultArea.textContent = "該当データがありません。";
                return;
            }
            // 各行を div 要素として追加
            lines.forEach(line => {
                const lineDiv = document.createElement("div");
                lineDiv.innerHTML = line; // innerHTML を使用して HTML を解釈
                resultArea.appendChild(lineDiv);
            });
        })
        .catch(error => {
            console.error("エラー:", error);
            resultArea.style.color = "red"; // エラー時も赤色
            document.getElementById("result-area").textContent = "エラーが発生しました。";
        });
    }
    document.addEventListener("DOMContentLoaded", () => {
        fetch("/extract_tooltips_v2")
            .then(response => response.json())
            .then(data => {
            if (data.html) {
                document.getElementById("container").innerHTML = data.html;
            }
        })
            .catch(error => console.error("ツールチップデータの取得に失敗しました:", error));
    });
    </script>
</form>
</html>
